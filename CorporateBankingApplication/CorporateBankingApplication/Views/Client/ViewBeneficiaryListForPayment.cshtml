
@model CorporateBankingApplication.DTOs.PaymentBeneficiaryDTO
@{
    ViewBag.Title = "View Beneficiary List for Payment";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5 pt-5">
    <div class="card shadow-lg rounded w-70">
        <div class="card-header bg-primary text-white text-center py-3">
            <h4>Pay to Beneficiary</h4>
        </div>
        <div class="card-body mx-5 px-5 my-5">
            @*@using (Html.BeginForm("SubmitPayment", "Client", FormMethod.Post))*@
            @using (Html.BeginForm())
            {
                <div class="form-group mb-3">
                    @Html.Label("Select Beneficiary:", new { @class = "form-label" })
                    @Html.DropDownList("BeneficiaryId", new SelectList(Enumerable.Empty<CorporateBankingApplication.DTOs.BeneficiaryDTO>(), "Id", "BeneficiaryName"), "Select a Beneficiary", new { @id = "Beneficiary_Id", @class = "form-select" })
                </div>

                <div class="form-group mb-3">
                    @Html.Label("Amount", new { @class = "form-label" })
                    @Html.TextBoxFor(m => m.Amount, new { @class = "form-control", type = "number", step = "0.01", min = "0" })
                </div>

                <div>
                    <button type="submit" class="btn btn-outline-dark mt-3">Pay Now</button>
                </div>
            }
        </div>
    </div>
    @Html.ActionLink("Go Back To Dashboard", "ClientDashboard", null, new { @class = "btn btn-lg btn-primary mt-5" })
</div>

<script>
    $(document).ready(function () {
        // AJAX request to get beneficiary list
        $.ajax({
            url: '@Url.Action("GetBeneficiaryListForPayment", "Client")',
            type: 'GET',
            success: function (response) {
                if (response.success) {
                    var select = $('#Beneficiary_Id');
                    select.empty();
                    select.append($('<option>').text('Select a Beneficiary').attr('value', ''));

                    // Populate the dropdown with beneficiaries
                    $.each(response.data.Beneficiaries, function (index, beneficiary) {
                        var beneficiaryText = beneficiary.BeneficiaryName + "            (" + beneficiary.BeneficiaryType + ")    ";
                        select.append($('<option>').text(beneficiaryText).attr('value', beneficiary.Id));
                    });
                } else {
                    alert(response.message);
                }
            },
            error: function (xhr, status, error) {
                console.error("Error: " + error);
                console.error("Response Text: " + xhr.responseText);
                alert("An error occurred: " + error);
            }
        });
    });
</script>

